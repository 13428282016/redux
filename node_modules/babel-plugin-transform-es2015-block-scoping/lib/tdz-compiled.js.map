{"version":3,"sources":["tdz.js"],"names":[],"mappings":"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","file":"tdz-compiled.js","sourcesContent":["\"use strict\";\n\nvar _interopRequireWildcard = require(\"babel-runtime/helpers/interop-require-wildcard\")[\"default\"];\n\nexports.__esModule = true;\n\nvar _babelTypes = require(\"babel-types\");\n\nvar t = _interopRequireWildcard(_babelTypes);\n\nfunction getTDZStatus(refPath, bindingPath) {\n  var executionStatus = bindingPath._guessExecutionStatusRelativeTo(refPath);\n\n  if (executionStatus === \"before\") {\n    return \"inside\";\n  } else if (executionStatus === \"after\") {\n    return \"outside\";\n  } else {\n    return \"maybe\";\n  }\n}\n\nfunction buildTDZAssert(node, file) {\n  return t.callExpression(file.addHelper(\"temporalRef\"), [node, t.stringLiteral(node.name), file.addHelper(\"temporalUndefined\")]);\n}\n\nfunction isReference(node, scope, state) {\n  var declared = state.letReferences[node.name];\n  if (!declared) return false;\n\n  // declared node is different in this scope\n  return scope.getBindingIdentifier(node.name) === declared;\n}\n\nvar visitor = {\n  ReferencedIdentifier: function ReferencedIdentifier(path, state) {\n    if (!this.file.opts.tdz) return;\n\n    var node = path.node;\n    var parent = path.parent;\n    var scope = path.scope;\n\n    if (path.parentPath.isFor({ left: node })) return;\n    if (!isReference(node, scope, state)) return;\n\n    var bindingPath = scope.getBinding(node.name).path;\n\n    var status = getTDZStatus(path, bindingPath);\n    if (status === \"inside\") return;\n\n    if (status === \"maybe\") {\n      var assert = buildTDZAssert(node, state.file);\n\n      // add tdzThis to parent variable declarator so it's exploded\n      bindingPath.parent._tdzThis = true;\n\n      path.skip();\n\n      if (path.parentPath.isUpdateExpression()) {\n        if (parent._ignoreBlockScopingTDZ) return;\n        path.parentPath.replaceWith(t.sequenceExpression([assert, parent]));\n      } else {\n        path.replaceWith(assert);\n      }\n    } else if (status === \"outside\") {\n      path.replaceWith(t.throwStatement(t.inherits(t.newExpression(t.identifier(\"ReferenceError\"), [t.stringLiteral(node.name + \" is not defined - temporal dead zone\")]), node)));\n    }\n  },\n\n  AssignmentExpression: {\n    exit: function exit(path, state) {\n      if (!this.file.opts.tdz) return;\n\n      var node = path.node;\n\n      if (node._ignoreBlockScopingTDZ) return;\n\n      var nodes = [];\n      var ids = path.getBindingIdentifiers();\n\n      for (var _name in ids) {\n        var id = ids[_name];\n\n        if (isReference(id, path.scope, state)) {\n          nodes.push(buildTDZAssert(id, state.file));\n        }\n      }\n\n      if (nodes.length) {\n        node._ignoreBlockScopingTDZ = true;\n        nodes.push(node);\n        path.replaceWithMultiple(nodes.map(t.expressionStatement));\n      }\n    }\n  }\n};\nexports.visitor = visitor;"]}